# The API will need to verify that each business rule could be created from a template
@smoke
Feature: List multiselect and publish template
  As a Business rule expert
  I want to publish a single or multiple templates
  So that this template/s could be used for the creation of a business rule in a merchant's pipeline

  @DISE-500
  Scenario: I publish one business rules template
    Given I send post request to create new business rule template with fields:
      | RuleTemplateId | {UUID}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | Name           | {STRING:10}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
      | Description    | {EMPTY}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | RuleXml        | "{\"Elements\":[{\"Type\":0,\"Name\":\"_divRuleEditor0\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"if\"},{\"Type\":1,\"Name\":\"_divRuleEditor1\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"ExecutionResult.RoutingResult.SelectedMID\",\"IsRule\":false,\"Max\":256},{\"Type\":3,\"Name\":\"_divRuleEditor2\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"equal\"},{\"Type\":4,\"Name\":\"_divRuleEditor4\",\"Oper\":0,\"FuncType\":4,\"InpType\":1,\"CalType\":9,\"Value\":\"123\"},{\"Type\":6,\"Name\":\"_divRuleEditor5\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"then\"},{\"Type\":17,\"Name\":\"_divRuleEditor6\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"set\"},{\"Type\":1,\"Name\":\"_divRuleEditor7\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"ExecutionResult.RoutingResult.SelectedMID\",\"IsRule\":false,\"Max\":256},{\"Type\":17,\"Name\":\"_divRuleEditor8\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"to\"},{\"Type\":4,\"Name\":\"_divRuleEditor10\",\"Oper\":0,\"FuncType\":4,\"InpType\":1,\"CalType\":9,\"Value\":\"123\"}],\"IsLoadedRuleOfEvalType\":false,\"Command\":\"ceExtract\",\"Mode\":0,\"Name\":\"A123\",\"SkipNameValidation\":false}" |
      | Type           | Routing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | Status         | {EMPTY}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
    And I send 'valid' request to publish rule template
    Then the status code should be '200'
    And business rule template is persisted in database
    And business rule status is 'Active'
    And document is existed in the database
#    And test record is removed from the database

  @DISE-500
  Scenario: I am trying to publish one business rules template with empty Id
    Given I send post request to create new business rule template with fields:
      | RuleTemplateId | {UUID}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | Name           | {STRING:10}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
      | Description    | {EMPTY}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | RuleXml        | "{\"Elements\":[{\"Type\":0,\"Name\":\"_divRuleEditor0\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"if\"},{\"Type\":1,\"Name\":\"_divRuleEditor1\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"ExecutionResult.RoutingResult.SelectedMID\",\"IsRule\":false,\"Max\":256},{\"Type\":3,\"Name\":\"_divRuleEditor2\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"equal\"},{\"Type\":4,\"Name\":\"_divRuleEditor4\",\"Oper\":0,\"FuncType\":4,\"InpType\":1,\"CalType\":9,\"Value\":\"123\"},{\"Type\":6,\"Name\":\"_divRuleEditor5\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"then\"},{\"Type\":17,\"Name\":\"_divRuleEditor6\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"set\"},{\"Type\":1,\"Name\":\"_divRuleEditor7\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"ExecutionResult.RoutingResult.SelectedMID\",\"IsRule\":false,\"Max\":256},{\"Type\":17,\"Name\":\"_divRuleEditor8\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"to\"},{\"Type\":4,\"Name\":\"_divRuleEditor10\",\"Oper\":0,\"FuncType\":4,\"InpType\":1,\"CalType\":9,\"Value\":\"123\"}],\"IsLoadedRuleOfEvalType\":false,\"Command\":\"ceExtract\",\"Mode\":0,\"Name\":\"A123\",\"SkipNameValidation\":false}" |
      | Type           | Routing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | Status         | {EMPTY}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
    When I send 'empty' request to publish rule template
    Then the status code should be '500'
    And business rule template is persisted in database
    And business rule status is 'Draft'
    And document is existed in the database
    And test record is removed from the database


  @DISE-500
  Scenario: I am trying to publish one business rules template with wrong parameter
    Given I send post request to create new business rule template with fields:
      | RuleTemplateId | {UUID}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | Name           | {STRING:10}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
      | Description    | {EMPTY}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | RuleXml        | "{\"Elements\":[{\"Type\":0,\"Name\":\"_divRuleEditor0\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"if\"},{\"Type\":1,\"Name\":\"_divRuleEditor1\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"ExecutionResult.RoutingResult.SelectedMID\",\"IsRule\":false,\"Max\":256},{\"Type\":3,\"Name\":\"_divRuleEditor2\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"equal\"},{\"Type\":4,\"Name\":\"_divRuleEditor4\",\"Oper\":0,\"FuncType\":4,\"InpType\":1,\"CalType\":9,\"Value\":\"123\"},{\"Type\":6,\"Name\":\"_divRuleEditor5\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"then\"},{\"Type\":17,\"Name\":\"_divRuleEditor6\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"set\"},{\"Type\":1,\"Name\":\"_divRuleEditor7\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"ExecutionResult.RoutingResult.SelectedMID\",\"IsRule\":false,\"Max\":256},{\"Type\":17,\"Name\":\"_divRuleEditor8\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"to\"},{\"Type\":4,\"Name\":\"_divRuleEditor10\",\"Oper\":0,\"FuncType\":4,\"InpType\":1,\"CalType\":9,\"Value\":\"123\"}],\"IsLoadedRuleOfEvalType\":false,\"Command\":\"ceExtract\",\"Mode\":0,\"Name\":\"A123\",\"SkipNameValidation\":false}" |
      | Type           | Routing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | Status         | {EMPTY}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
    When I send 'wrong' request to publish rule template
    Then the status code should be '500'
    And business rule template is persisted in database
    And business rule status is 'Draft'
    And document is existed in the database
    And test record is removed from the database

  @DISE-500
  Scenario: I try to publish the business rules template with the same name
    Given I send post request to create new business rule template with fields:
      | RuleTemplateId | {UUID}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | Name           | AAAAA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
      | Description    | {EMPTY}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | RuleXml        | "{\"Elements\":[{\"Type\":0,\"Name\":\"_divRuleEditor0\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"if\"},{\"Type\":1,\"Name\":\"_divRuleEditor1\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"ExecutionResult.RoutingResult.SelectedMID\",\"IsRule\":false,\"Max\":256},{\"Type\":3,\"Name\":\"_divRuleEditor2\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"equal\"},{\"Type\":4,\"Name\":\"_divRuleEditor4\",\"Oper\":0,\"FuncType\":4,\"InpType\":1,\"CalType\":9,\"Value\":\"123\"},{\"Type\":6,\"Name\":\"_divRuleEditor5\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"then\"},{\"Type\":17,\"Name\":\"_divRuleEditor6\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"set\"},{\"Type\":1,\"Name\":\"_divRuleEditor7\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"ExecutionResult.RoutingResult.SelectedMID\",\"IsRule\":false,\"Max\":256},{\"Type\":17,\"Name\":\"_divRuleEditor8\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"to\"},{\"Type\":4,\"Name\":\"_divRuleEditor10\",\"Oper\":0,\"FuncType\":4,\"InpType\":1,\"CalType\":9,\"Value\":\"123\"}],\"IsLoadedRuleOfEvalType\":false,\"Command\":\"ceExtract\",\"Mode\":0,\"Name\":\"A123\",\"SkipNameValidation\":false}" |
      | Type           | Routing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | Status         | {EMPTY}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
    And I send 'valid' request to publish rule template
    Then the status code should be '200'
    And I send post request to create new business rule template with fields:
      | RuleTemplateId | {UUID}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | Name           | AAAAA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
      | Description    | {EMPTY}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | RuleXml        | "{\"Elements\":[{\"Type\":0,\"Name\":\"_divRuleEditor0\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"if\"},{\"Type\":1,\"Name\":\"_divRuleEditor1\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"ExecutionResult.RoutingResult.SelectedMID\",\"IsRule\":false,\"Max\":256},{\"Type\":3,\"Name\":\"_divRuleEditor2\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"equal\"},{\"Type\":4,\"Name\":\"_divRuleEditor4\",\"Oper\":0,\"FuncType\":4,\"InpType\":1,\"CalType\":9,\"Value\":\"123\"},{\"Type\":6,\"Name\":\"_divRuleEditor5\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"then\"},{\"Type\":17,\"Name\":\"_divRuleEditor6\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"set\"},{\"Type\":1,\"Name\":\"_divRuleEditor7\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"ExecutionResult.RoutingResult.SelectedMID\",\"IsRule\":false,\"Max\":256},{\"Type\":17,\"Name\":\"_divRuleEditor8\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"to\"},{\"Type\":4,\"Name\":\"_divRuleEditor10\",\"Oper\":0,\"FuncType\":4,\"InpType\":1,\"CalType\":9,\"Value\":\"123\"}],\"IsLoadedRuleOfEvalType\":false,\"Command\":\"ceExtract\",\"Mode\":0,\"Name\":\"A123\",\"SkipNameValidation\":false}" |
      | Type           | Routing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      | Status         | {EMPTY}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
    And the status code should be '500'
    And business rule template is persisted in database
    And business rule status is 'Active'
    And document is existed in the database
    And test record is removed from the database

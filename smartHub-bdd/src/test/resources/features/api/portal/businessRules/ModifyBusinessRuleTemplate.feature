# The API will need to verify that each business rule could be created from a template
Feature: Modify business rule template
  As a Admin
  I want to to edit a template
  So that every template is up-to-date

  @DISE-270
  Scenario: Edit new business rule template
    Given I send post request to create new business rule template with fields:
      | name        | {STRING:15}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
      | description | description1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
      | ruleXml     | "{\"Elements\":[{\"Type\":0,\"Name\":\"_divRuleEditor10\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"if\"},{\"Type\":1,\"Name\":\"_divRuleEditor11\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"RuleData.CardRuleData.Brand\",\"IsRule\":false,\"Max\":256},{\"Type\":3,\"Name\":\"_divRuleEditor12\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"equal\"},{\"Type\":4,\"Name\":\"_divRuleEditor13\",\"Oper\":0,\"FuncType\":4,\"InpType\":0,\"CalType\":9,\"Value\":\"Transaction.Card.Brand\"},{\"Type\":6,\"Name\":\"_divRuleEditor14\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"then\"},{\"Type\":7,\"Name\":\"_divRuleEditor15\",\"Oper\":16,\"FuncType\":0,\"InpType\":2,\"CalType\":9,\"Value\":\"5CF0C6655937BADD63DC8B8C2E33EAA3\"},{\"Type\":7,\"Name\":\"_divRuleEditor16\",\"Oper\":8,\"FuncType\":1,\"InpType\":0,\"CalType\":9,\"Value\":\"RuleData.BusinessMIDs\"},{\"Type\":7,\"Name\":\"_divRuleEditor17\",\"Oper\":16,\"FuncType\":3,\"InpType\":2,\"CalType\":9,\"Value\":\"5CF0C6655937BADD63DC8B8C2E33EAA3\"}],\"Id\":\"91a6d193-85cc-4e71-b285-9fc0fd{randomId}\",\"IsLoadedRuleOfEvalType\":false,\"Command\":\"ceExtract\",\"Mode\":0,\"Name\":\"for testing purpose222\",\"Desc\":\"description\",\"SkipNameValidation\":false}" |
      | type        | Routing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
    When I send request to change rule template with fields:
      | name        | {STRING:5}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
      | description | description2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
      | ruleXml     | "{\"Elements\":[{\"Type\":0,\"Name\":\"_divRuleEditor10\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"if\"},{\"Type\":1,\"Name\":\"_divRuleEditor11\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"RuleData.CardRuleData.Brand\",\"IsRule\":false,\"Max\":256},{\"Type\":3,\"Name\":\"_divRuleEditor12\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"equal\"},{\"Type\":4,\"Name\":\"_divRuleEditor13\",\"Oper\":0,\"FuncType\":4,\"InpType\":0,\"CalType\":9,\"Value\":\"Transaction.Card.Brand\"},{\"Type\":6,\"Name\":\"_divRuleEditor14\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"then\"},{\"Type\":7,\"Name\":\"_divRuleEditor15\",\"Oper\":16,\"FuncType\":0,\"InpType\":2,\"CalType\":9,\"Value\":\"5CF0C6655937BADD63DC8B8C2E33EAA3\"},{\"Type\":7,\"Name\":\"_divRuleEditor16\",\"Oper\":8,\"FuncType\":1,\"InpType\":0,\"CalType\":9,\"Value\":\"RuleData.BusinessMIDs\"},{\"Type\":7,\"Name\":\"_divRuleEditor17\",\"Oper\":16,\"FuncType\":3,\"InpType\":2,\"CalType\":9,\"Value\":\"5CF0C6655937BADD63DC8B8C2E33EAA3\"}],\"Id\":\"91a6d193-85cc-4e71-b285-9fc0fd{randomId}\",\"IsLoadedRuleOfEvalType\":false,\"Command\":\"ceExtract\",\"Mode\":0,\"Name\":\"for testing purpose2\",\"Desc\":\"description\",\"SkipNameValidation\":false}" |
      | type        | Routing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
    Then the status code should be '200'
    And response has no errors
    And business rule template is persisted in database

  @DISE-270
  Scenario: Try to edit new business rule template with EMPTY template's name
    Given I send post request to create new business rule template with fields:
      | name        | {STRING:11}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
      | description | description3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
      | ruleXml     | "{\"Elements\":[{\"Type\":0,\"Name\":\"_divRuleEditor10\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"if\"},{\"Type\":1,\"Name\":\"_divRuleEditor11\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"RuleData.CardRuleData.Brand\",\"IsRule\":false,\"Max\":256},{\"Type\":3,\"Name\":\"_divRuleEditor12\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"equal\"},{\"Type\":4,\"Name\":\"_divRuleEditor13\",\"Oper\":0,\"FuncType\":4,\"InpType\":0,\"CalType\":9,\"Value\":\"Transaction.Card.Brand\"},{\"Type\":6,\"Name\":\"_divRuleEditor14\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"then\"},{\"Type\":7,\"Name\":\"_divRuleEditor15\",\"Oper\":16,\"FuncType\":0,\"InpType\":2,\"CalType\":9,\"Value\":\"5CF0C6655937BADD63DC8B8C2E33EAA3\"},{\"Type\":7,\"Name\":\"_divRuleEditor16\",\"Oper\":8,\"FuncType\":1,\"InpType\":0,\"CalType\":9,\"Value\":\"RuleData.BusinessMIDs\"},{\"Type\":7,\"Name\":\"_divRuleEditor17\",\"Oper\":16,\"FuncType\":3,\"InpType\":2,\"CalType\":9,\"Value\":\"5CF0C6655937BADD63DC8B8C2E33EAA3\"}],\"Id\":\"91a6d193-85cc-4e71-b285-9fc0fd{randomId}\",\"IsLoadedRuleOfEvalType\":false,\"Command\":\"ceExtract\",\"Mode\":0,\"Name\":\"for testing purpose222\",\"Desc\":\"description\",\"SkipNameValidation\":false}" |
      | type        | Routing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
    When I send request to change rule template with fields:
      | name        | {EMPTY}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
      | description | description4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
      | ruleXml     | "{\"Elements\":[{\"Type\":0,\"Name\":\"_divRuleEditor10\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"if\"},{\"Type\":1,\"Name\":\"_divRuleEditor11\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"RuleData.CardRuleData.Brand\",\"IsRule\":false,\"Max\":256},{\"Type\":3,\"Name\":\"_divRuleEditor12\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"equal\"},{\"Type\":4,\"Name\":\"_divRuleEditor13\",\"Oper\":0,\"FuncType\":4,\"InpType\":0,\"CalType\":9,\"Value\":\"Transaction.Card.Brand\"},{\"Type\":6,\"Name\":\"_divRuleEditor14\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"then\"},{\"Type\":7,\"Name\":\"_divRuleEditor15\",\"Oper\":16,\"FuncType\":0,\"InpType\":2,\"CalType\":9,\"Value\":\"5CF0C6655937BADD63DC8B8C2E33EAA3\"},{\"Type\":7,\"Name\":\"_divRuleEditor16\",\"Oper\":8,\"FuncType\":1,\"InpType\":0,\"CalType\":9,\"Value\":\"RuleData.BusinessMIDs\"},{\"Type\":7,\"Name\":\"_divRuleEditor17\",\"Oper\":16,\"FuncType\":3,\"InpType\":2,\"CalType\":9,\"Value\":\"5CF0C6655937BADD63DC8B8C2E33EAA3\"}],\"Id\":\"91a6d193-85cc-4e71-b285-9fc0fd{randomId}\",\"IsLoadedRuleOfEvalType\":false,\"Command\":\"ceExtract\",\"Mode\":0,\"Name\":\"for testing purpose222\",\"Desc\":\"description\",\"SkipNameValidation\":false}" |
      | type        | MID Condition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
    Then the status code should be '400'

  @DISE-270
  Scenario: Try to edit ACTIVE business rule template
    Given I send post request to create new business rule template with fields:
      | name        | {STRING:15}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
      | description | description5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
      | ruleXml     | "{\"Elements\":[{\"Type\":0,\"Name\":\"_divRuleEditor10\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"if\"},{\"Type\":1,\"Name\":\"_divRuleEditor11\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"RuleData.CardRuleData.Brand\",\"IsRule\":false,\"Max\":256},{\"Type\":3,\"Name\":\"_divRuleEditor12\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"equal\"},{\"Type\":4,\"Name\":\"_divRuleEditor13\",\"Oper\":0,\"FuncType\":4,\"InpType\":0,\"CalType\":9,\"Value\":\"Transaction.Card.Brand\"},{\"Type\":6,\"Name\":\"_divRuleEditor14\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"then\"},{\"Type\":7,\"Name\":\"_divRuleEditor15\",\"Oper\":16,\"FuncType\":0,\"InpType\":2,\"CalType\":9,\"Value\":\"5CF0C6655937BADD63DC8B8C2E33EAA3\"},{\"Type\":7,\"Name\":\"_divRuleEditor16\",\"Oper\":8,\"FuncType\":1,\"InpType\":0,\"CalType\":9,\"Value\":\"RuleData.BusinessMIDs\"},{\"Type\":7,\"Name\":\"_divRuleEditor17\",\"Oper\":16,\"FuncType\":3,\"InpType\":2,\"CalType\":9,\"Value\":\"5CF0C6655937BADD63DC8B8C2E33EAA3\"}],\"Id\":\"91a6d193-85cc-4e71-b285-9fc0fd{randomId}\",\"IsLoadedRuleOfEvalType\":false,\"Command\":\"ceExtract\",\"Mode\":0,\"Name\":\"for testing purpose222\",\"Desc\":\"description\",\"SkipNameValidation\":false}" |
      | type        | Routing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
    And I send 'valid' request to publish rule template
    When I send request to change rule template with fields:
      | name        | {STRING:5}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
      | description | description6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
      | ruleXml     | "{\"Elements\":[{\"Type\":0,\"Name\":\"_divRuleEditor10\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"if\"},{\"Type\":1,\"Name\":\"_divRuleEditor11\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"RuleData.CardRuleData.Brand\",\"IsRule\":false,\"Max\":256},{\"Type\":3,\"Name\":\"_divRuleEditor12\",\"Oper\":0,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"equal\"},{\"Type\":4,\"Name\":\"_divRuleEditor13\",\"Oper\":0,\"FuncType\":4,\"InpType\":0,\"CalType\":9,\"Value\":\"Transaction.Card.Brand\"},{\"Type\":6,\"Name\":\"_divRuleEditor14\",\"Oper\":16,\"FuncType\":4,\"InpType\":2,\"CalType\":9,\"Value\":\"then\"},{\"Type\":7,\"Name\":\"_divRuleEditor15\",\"Oper\":16,\"FuncType\":0,\"InpType\":2,\"CalType\":9,\"Value\":\"5CF0C6655937BADD63DC8B8C2E33EAA3\"},{\"Type\":7,\"Name\":\"_divRuleEditor16\",\"Oper\":8,\"FuncType\":1,\"InpType\":0,\"CalType\":9,\"Value\":\"RuleData.BusinessMIDs\"},{\"Type\":7,\"Name\":\"_divRuleEditor17\",\"Oper\":16,\"FuncType\":3,\"InpType\":2,\"CalType\":9,\"Value\":\"5CF0C6655937BADD63DC8B8C2E33EAA3\"}],\"Id\":\"91a6d193-85cc-4e71-b285-9fc0fd{randomId}\",\"IsLoadedRuleOfEvalType\":false,\"Command\":\"ceExtract\",\"Mode\":0,\"Name\":\"for testing purpose222\",\"Desc\":\"description\",\"SkipNameValidation\":false}" |
      | type        | Routing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
    Then the status code should be '400'
